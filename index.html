<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å’ªè’™çš„å®ˆæŠ¤å°å±‹</title>

  <style>
    :root { --bg-gradient: radial-gradient(circle at center, #1b2735 0%, #090a0f 100%); }
    body{ margin:0; background: var(--bg-gradient); color:white; font-family:sans-serif; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; overflow:hidden; }
    .scene{ position:relative; width:400px; height:320px; overflow:hidden; }
    #mimeng{ position:absolute; z-index:1; width:100px; left: 63.5%; bottom: 5px; opacity:0; filter: brightness(0.3); transform: translateX(-88px) scale(0.95); transition: all 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
    #mimeng.peek-head{ opacity:1; filter: brightness(1); transform: translateX(-69px) scale(0.98); }
    #mimeng.peek-half{ opacity:1; filter: brightness(1); transform: translateX(-75px) scale(1); }
    #mimeng.out{ opacity:1; filter: brightness(2); transform: translateX(-28px) scale(1); }
    #mimeng.hidden{ opacity:0 !important; }
    #mimeng-close-up{ position:fixed; top:45%; left:50%; width:320px; z-index:1000; transform: translate(-50%, -50%) scale(0); transition: transform 0.3s; filter: drop-shadow(0 0 50px rgba(0,0,0,0.9)); pointer-events:none; }
    #mimeng-close-up.show{ transform: translate(-50%, -50%) scale(1); animation: struggle-vibrate 0.1s infinite; }
    @keyframes struggle-vibrate{ 0%,100% { transform: translate(-50%, -50%) rotate(0deg); } 25% { transform: translate(-51%, -51%) rotate(-2deg); } 75% { transform: translate(-49%, -49%) rotate(2deg); } }
    @keyframes happy-bounce{ 0%,100% { transform: translateX(-28px) translateY(0) rotate(0deg) scale(1); } 50% { transform: translateX(-33px) translateY(-10px) rotate(5deg) scale(1); } }
    .is-happy{ animation: happy-bounce 0.4s ease 2 !important; }
    .hut-foreground{ position:absolute; bottom:0; left:0; width:100%; z-index:2; pointer-events:none; }
    .panel{ width:95%; max-width:440px; background: rgba(255,255,255,0.08); backdrop-filter: blur(20px); border-radius: 28px; padding: 20px; margin-top: 15px; border: 1px solid rgba(255,255,255,0.15); z-index: 10; }
    #chat-history{ height:180px; overflow-y:auto; margin-bottom:15px; mask-image: linear-gradient(to top, black 85%, transparent 100%); }
    .msg{ margin-bottom:12px; font-size: 13.5px; } .msg.m{ color:#ffcc00; } .msg.u{ color: rgba(255,255,255,0.55); font-style: italic; }
    .btn-group{ display:flex; gap:8px; justify-content:center; margin-bottom:12px; }
    button{ background: rgba(255,255,255,0.12); border: 1px solid rgba(255,255,255,0.25); color:white; padding:8px 14px; border-radius:16px; cursor:pointer; }
    .btn-primary{ background:#d35400; border:none; }
  </style>
</head>
<body>
  <div class="scene"><img src="mimeng.jpg" id="mimeng"><img src="hut.png" class="hut-foreground"></div>
  <img src="mimeng_touch.gif" id="mimeng-close-up">
  <div class="panel">
    <div id="chat-history"></div>
    <div class="btn-group">
      <button class="btn-primary" onclick="handleKnock()">ğŸ¾ æ•²é—¨</button>
      <button onclick="handleFeed()">ğŸ§€ è¯±æƒ‘</button>
      <button style="background:#8e44ad;" onclick="handleTouch()">ğŸ’†â€â™‚ï¸ è¹‚èº</button>
    </div>
    <input type="text" id="userInput" placeholder="è·Ÿå’ªè’™è¯´è¯´è¯..." autocomplete="off" style="width:100%; background:rgba(0,0,0,0.4); border:1px solid rgba(255,255,255,0.15); padding:12px; color:white; border-radius:16px;">
  </div>

  <script>
    const mimeng = document.getElementById('mimeng');
    const closeup = document.getElementById('mimeng-close-up');
    const history = document.getElementById('chat-history');
    const input = document.getElementById('userInput');
    let feedStep = 0, isStruggling = false, memoryQueue = [];

    const MimengSoul = {
      positive: [
        "æƒ³å‘€ï¼æˆ‘æ¯å¤©éƒ½åœ¨å«æ–™é‡Œç”»å¦ˆå¦ˆçš„åå­—ï¼Œå°è·Ÿç­ç°åœ¨ä¹Ÿè·Ÿç€æˆ‘å­¦å‘¢ï¼",
        "è¿‡å¾—è¶…æ»‹æ¶¦ï¼æˆ‘æœ‰ä¸€ä¸ªè¶…çº§å¤§çš„é›¶é£Ÿä»“ï¼Œé‡Œé¢å…¨æ˜¯è“è“å’Œè™¾å¹²ï¼Œæ ¹æœ¬åƒä¸å®Œã€‚",
        "å°è·Ÿç­è§‰å¾—æˆ‘è·‘è½®è·‘å¾—å¯å¿«äº†ï¼å¥¹éƒ½ç”¨å´‡æ‹œçš„çœ¼ç¥ç›¯ç€æˆ‘ã€‚å˜¿å˜¿ã€‚",
        "è¿™é‡Œå«æ–™åˆåšåˆè½¯ï¼Œæˆ‘è¿˜æ•™å°è·Ÿç­å‰¥ç“œå­ï¼Œå½“å“¥å“¥çš„æ„Ÿè§‰çœŸæ£’ï¼",
        "æˆ‘ç»å¸¸è·Ÿå°è·Ÿç­è®²å¦ˆå¦ˆä»¥å‰ç»™æˆ‘æ´—é¦™é¦™çš„æ•…äº‹å‘¢ï¼Œå¥¹å¬å¾—å¯è®¤çœŸäº†ã€‚",
        "å¼€å¿ƒå‘€ï¼åˆšæ‰è¿˜å¸¦ Mr.Big çš„å¥³å„¿å»å·¡è§†æˆ‘çš„å¤§é›¶é£Ÿä»“äº†ï¼"
      ],
      friends: [
        "æˆ‘çš„æœ‹å‹å¯å¤šå•¦ï¼Mr.Big çš„å¥³å„¿å°±æ˜¯æˆ‘æœ€å¿ å®çš„å°è·Ÿç­ï¼Œæ¯å¤©éƒ½å›´ç€æˆ‘è½¬ã€‚",
        "æˆ‘æœ‰ä¸‰ä¸ªè¶…å¤§çš„çŒ«å“¥å“¥ä¿é•–å‘€ï¼å¤§é»„ã€æ¡æ¡å’Œå¡å¡ï¼Œè°æ•¢æ¬ºè´Ÿæˆ‘ï¼Ÿ",
        "åœ¨è¿™é‡Œæˆ‘å¯æ˜¯â€˜å‰¥ç“œå­æ•™ç»ƒâ€™ï¼Œæ•™äº†ä¸€å †å°ä¼™ä¼´å‰¥ç“œå­ï¼Œå¤§å®¶éƒ½å«æˆ‘å’ªè’™å“¥ï¼",
        "å°è·Ÿç­ç°åœ¨æ˜¯æˆ‘æœ€å¥½çš„æœ‹å‹ï¼Œå¥¹ç»å¸¸å¸®æˆ‘æ•´ç†å«æ–™ï¼Œè¿˜å¤¸æˆ‘è·‘è½®è·‘å¾—æœ€å¸…ã€‚"
      ],
      cats: [
        "å¤§é»„å“¥å“¥åˆåœ¨å¤–é¢ç›¯ç€çœ‹ï¼Œä»–ä¸€å®šæ˜¯å«‰å¦’æˆ‘æœ‰è¿™ä¹ˆå¤šå¥½åƒçš„ï¼Œå“¼ã€‚",
        "æ¡æ¡å“¥å“¥åˆšæ‰åœ¨æ­ªå¤´è§‚å¯Ÿæˆ‘è·‘è½®ï¼Œä»–ä¸€å®šæ²¡è§è¿‡è·‘å¾—è¿™ä¹ˆå¿«çš„é‡‘ä¸ç†Šï¼",
        "å¡å¡å“¥å“¥æœ€æ¸©æŸ”ï¼Œä¸€ç›´é™é™å®ˆç€æˆ‘ã€‚çŒªçŒªç´¯äº†å°±å»æŠ±æŠ±å¡å¡ã€‚",
        "åˆšæ‰è·Ÿå°è·Ÿç­å¹ç‰›ï¼Œè¯´å®¶é‡Œé‚£ä¸‰åªå¤§çŒ«å“¥å“¥éƒ½æ˜¯æˆ‘çš„ä¿é•–ï¼"
      ],
      night: [
        "ä¸è¦æŠ å˜´çš®ï¼æˆ‘åœ¨çœ‹ç€ä½ å–”ï¼Œæ‰‹æ‰‹æ”¾ä¸‹æ¥å¥½ä¸å¥½ï¼Ÿ",
        "æ”¾ä¸‹æ‰‹æœºå•¦ï¼ç§¦å½»åˆä¸ä¼šé™ªä½ ç¡è§‰ï¼Œå¿«å»æŠ±å¡å¡å“¥å“¥ç¡å§ã€‚",
        "ç†¬å¤œé•¿é»‘çœ¼åœˆï¼Œç§¦å½»å°±ä¸å¸…äº†ã€‚å¿«é—­çœ¼ï¼Œå»æŠ±å¡å¡ç¡è§‰ï¼",
        "å·¥ä½œåšä¸å®Œå°±æ˜å¤©å†åšå˜›ï¼ŒæŠ å˜´çš®ä¼šæŠ ç—›çš„ï¼Œæˆ‘ä¼šå¿ƒç–¼ã€‚"
      ],
      confirm: [
        "ï¼ˆå—…å—…ï¼‰æ˜¯è“è“çš„å‘³é“å—ï¼Ÿç¡®è®¤äº†æˆ‘å°±å®Œå…¨æ¢å‡ºèº«å­ï¼",
        "é—»åˆ°äº†...å¥½åƒæ˜¯è±†è…å†»å¹²ï¼Ÿæ¡æ¡å“¥å“¥æ˜¯ä¸æ˜¯ä¹Ÿæƒ³è¦ï¼Ÿ",
        "è¿™ç§ç”œå‘³...æ˜¯èŠå£«é¥¼å¹²å¯¹ä¸å¯¹ï¼å¦ˆå¦ˆåˆ«éª—æˆ‘å–”ã€‚"
      ],
      tasty: [
        "ï¼ˆå’”åš“å’”åš“ï¼‰è¿™ä¸ªè™¾å¹²å¥½é…¥ï¼è¿˜è¦ï¼",
        "è“è“ï¼æœ€çˆ±ï¼åƒåˆ°å¥½åƒçš„æˆ‘å°±æƒ³è·³èˆï¼",
        "ï¼ˆå¡æ»¡é¢Šå›Šï¼‰å¦ˆå¦ˆçœŸå¥½ï¼Œè¿™äº›æˆ‘è¦å¸¦å›é›¶é£Ÿä»“å­˜ç€ã€‚"
      ],
      struggle: ["å“å“å“ï¼è‚‰è‚‰éƒ½è¦æå‡ºæ¥å•¦ï¼","å¤§é»„å¿«æ•‘æˆ‘ï¼å¦ˆå¦ˆåï¼","æ¡æ¡å¿«å¸®æˆ‘æŠ“å¦ˆå¦ˆï¼","ç‰›ç±³å¿«æ¥æ•‘å‘½ï¼å¦ˆå¦ˆåœ¨è¹‚èºæˆ‘ï¼"],
      escape: ["ç¡è§‰å»äº†ï¼Œä¸ä¿¡ä½ äº†ï¼","ï¼ˆå—–â€”â€”ï¼‰","ä¸‹æ¬¡å†éª—æˆ‘ï¼Œæˆ‘ä¸å‡ºæ¥äº†ã€‚"]
    };

    function smartPick(pool){
      let filtered = pool.filter(item => !memoryQueue.includes(item));
      if (filtered.length === 0) { memoryQueue = []; filtered = pool; }
      const picked = filtered[Math.floor(Math.random() * filtered.length)];
      memoryQueue.push(picked);
      if (memoryQueue.length > 10) memoryQueue.shift();
      return picked;
    }

    const STATES = ["peek-head", "peek-half", "out"];
    function hasState(s){ return mimeng.classList.contains(s); }
    function setState(s){ STATES.forEach(x => mimeng.classList.remove(x)); if (s) mimeng.classList.add(s); }
    function clearHidden(){ mimeng.classList.remove("hidden"); }

    async function addLog(sender, text, type){
      const div = document.createElement('div');
      div.className = `msg ${type}`;
      div.innerHTML = `<strong>${sender === 'ä½ ' ? 'çŒªçŒª' : 'å’ªè’™'}ï¼š</strong> `;
      history.appendChild(div);
      if (sender !== 'ä½ ' && !hasState("out") && !mimeng.classList.contains("hidden")) { clearHidden(); setState("peek-half"); }
      for (let char of text){ div.innerHTML += char; history.scrollTop = history.scrollHeight; await new Promise(r => setTimeout(r, 35)); }
      setTimeout(() => { if (hasState("peek-half") && !hasState("out")) setState(""); }, 5000);
    }

    function handleKnock(){
      feedStep = 0; addLog("ä½ ", "ï¼ˆæ•²æ•²å°é—¨ï¼‰", "u"); clearHidden();
      if (!hasState("out")) setState("peek-half");
      setTimeout(() => addLog("å’ªè’™", "æ˜¯å¤§é»„åˆåœ¨è°ƒçš®ï¼Ÿè¿˜æ˜¯å¦ˆå¦ˆå¸¦äº†åœŸè±†ä¸ï¼Ÿ", "m"), 600);
    }

    function handleFeed(){
      if (hasState("out")) { mimeng.classList.add('is-happy'); addLog("å’ªè’™", smartPick(MimengSoul.tasty), "m"); setTimeout(() => mimeng.classList.remove('is-happy'), 1000); return; }
      feedStep++; clearHidden();
      if (feedStep === 1) { setState("peek-head"); addLog("å’ªè’™", smartPick(MimengSoul.confirm), "m"); }
      else { setState("out"); mimeng.classList.add('is-happy'); addLog("å’ªè’™", "ï¼ˆæŒªæŒªï¼‰å“‡ï¼ç¡®å®šæ˜¯å¥½åƒçš„ï¼çˆ±æ­»å¦ˆå¦ˆäº†ï¼", "m"); setTimeout(() => mimeng.classList.remove('is-happy'), 1000); }
    }

    function handleTouch(){
      if (!hasState("out")) { addLog("ä½ ", "ï¼ˆä¼¸æ‰‹æ‰æ‰ï¼‰", "u"); addLog("å’ªè’™", "æˆ‘è¿˜æ²¡å®Œå…¨å‡ºæ¥å‘¢ï¼Œå…ˆè¯±æƒ‘ä¸¤æ¬¡æŠŠæˆ‘éª—å‡ºæ¥ï¼", "m"); return; }
      if (isStruggling) return;
      isStruggling = true; mimeng.classList.add('hidden'); closeup.classList.add('show');
      addLog("ä½ ", "ï¼ˆæŠ“ä½è¹‚èºï¼ï¼‰", "u"); addLog("å’ªè’™", smartPick(MimengSoul.struggle), "m");
      setTimeout(() => { closeup.classList.remove('show'); mimeng.classList.remove('hidden'); setState(""); feedStep = 0; isStruggling = false; addLog("å’ªè’™", `ï¼ˆå—–â€”â€”ç¼©å›å»äº†ï¼‰${smartPick(MimengSoul.escape)}`, "m"); }, 3000);
    }

    input.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        const val = input.value.trim(); if (!val) return;
        addLog("ä½ ", val, "u");
        const h = new Date().getHours();
        const isLunch = h >= 11 && h <= 13;
        let reply;
        if (val.includes("æœ‹å‹") || val.includes("ä¼™ä¼´") || val.includes("å°è·Ÿç­")) reply = smartPick(MimengSoul.friends);
        else if (val.includes("ç§¦å½»")) reply = "ç§¦å½»åªæ˜¯æ¸¸æˆé‡Œçš„ï¼Œæˆ‘æ‰æ˜¯çœŸçš„ï¼å¦ˆå¦ˆå¿«çœ‹æˆ‘è·³èˆï¼";
        else if (val.includes("åœŸè±†ä¸") || (isLunch && (val.includes("é¥­") || val.includes("åƒ")))) reply = "ä»Šå¤©åˆé¤æœ‰åœŸè±†ä¸å—ï¼Ÿå¦ˆå¦ˆè®°å¾—å¸®æˆ‘å¤šåƒä¸¤å£ï¼ŒæŠŠæˆ‘çš„é‚£ä»½ä¹Ÿåƒäº†ï¼";
        else if (val.includes("æƒ³æˆ‘å—") || val.includes("æƒ³ä½ ") || val.includes("æ€ä¹ˆæ ·") || val.includes("å¥½å—")) reply = smartPick(MimengSoul.positive);
        else if (val.includes("å¤§é»„") || val.includes("æ¡æ¡") || val.includes("å¡å¡")) reply = smartPick(MimengSoul.cats);
        else reply = (h >= 22 || h < 5) ? smartPick(MimengSoul.night) : smartPick(MimengSoul.positive);
        setTimeout(() => addLog("å’ªè’™", reply, "m"), 600);
        input.value = "";
      }
    });
    addLog("å’ªè’™", "ï¼ˆåœ¨å±‹é‡ŒæŒªæŒªï¼‰å¦ˆå¦ˆï¼Œä½ æ¥æ‰¾æˆ‘ç©å—ï¼Ÿå¤§é»„å’Œæ¡æ¡åœ¨å·çœ‹å—ï¼Ÿ", "m");
  </script>
</body>
</html>

